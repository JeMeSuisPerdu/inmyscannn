{% extends 'base.html.twig' %}

{% block title %}Accueil | Animes et scans gratuits et en VOSTFR{% endblock %}

{% block body %}
    {{ navbar() }}
    <div class="home-container-box">
        <div class="header-section">
            <div class="header-background">
                <img style="width: 100%;height: 100%;object-fit: cover;" src="{{ asset('img/video/border1.gif') }}" alt="Bannière anime">
                <div class="header-image" aria-hidden="true"></div>
                <div class="header-overlay" aria-hidden="true"></div>
            </div>
            <div class="quote-container">
                <div class="header-content-wrapper">
                    <div class="header-content">
                        <form action="{{ path('search_manga') }}" class="search-form" method="get" role="search">
                            <button class="search-button" type="submit" aria-label="Rechercher un scan">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                                </svg>
                            </button>
                            <input autocomplete="off" id="searchMangaDownload" name="query" class="search-input" placeholder="Rechercher un manga" required type="text" aria-label="Rechercher un manga">
                            <button class="reset-button" type="reset" aria-label="Réinitialiser la recherche">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                                </svg>
                            </button>
                            <button id="searchButtonBar" type="submit">Rechercher</button>
                        </form>
                        <ul id="search-results" class="search-results" role="list"></ul>
                    </div>
                </div>
            </div>
        </div>

    <div class="main-video-container">
        <div class="video-container">
            <h2 style="display: flex; justify-content: center;">Halloween avant l'heure ça te tente ?</h2>
            <div class="anime-box">
                <div class="anime-list">
                    {% for manga in actionMangas %}
                        <article class="anime-container">
                            <div class="anime-item">
                                <a href="{{ path('voir_anime', { 'mangaId': manga.id, 'saison': 1 }) }}" aria-label="Voir {{ manga.titre }}">
                                    <img src="{{ asset('img/anime_pfp/' ~ manga.photo) }}" alt="Couverture de {{ manga.titre }}" loading="lazy" class="clickable-image">
                                </a>
                            </div>
                            <h2>{{ manga.titre }}</h2>
                            <p>
                                {% if mangasWithRoles[manga.titre] is defined %}
                                    {% for role in mangasWithRoles[manga.titre] %}
                                        <span style="display: none;">{{ role }}</span>
                                    {% endfor %}
                                {% else %}
                                {% endif %}
                            </p>
                        </article>
                    {% else %}
                        <p>Aucun manga d'action trouvé.</p>
                    {% endfor %}
                </div>
            </div>

            <h3 style="display: flex; justify-content: center;">Une touche de romance, ça te dit, non ?</h3>
            <div class="anime-box">
                <div class="anime-list">
                    {% for manga in romanceMangas %}
                        <article class="anime-container">
                            <div class="anime-item">
                                <a href="{{ path('voir_anime', { 'mangaId': manga.id, 'saison': 1 }) }}" aria-label="Voir {{ manga.titre }}">
                                    <img src="{{ asset('img/anime_pfp/' ~ manga.photo) }}" alt="Couverture de {{ manga.titre }}" loading="lazy" class="clickable-image">
                                </a>
                            </div>
                            <h2>{{ manga.titre }}</h2>
                            <p>
                                {% if mangasWithRoles[manga.titre] is defined %}
                                    {% for role in mangasWithRoles[manga.titre] %}
                                        <span style="display: none;">{{ role }}</span>
                                    {% endfor %}
                                {% else %}
                                {% endif %}
                            </p>
                        </article>
                    {% else %}
                        <p>Aucun manga trouvé.</p>
                    {% endfor %}
                </div>
            </div>
        </div>
        
    <div class="main-anime-container">
        <h3 style="display: flex; justify-content: center;">L'aléatoire nous surprendra toujours...</h3>
        <div class="anime-box">
            <div class="anime-list">
                {% for manga in mangas %}
                    <article class="anime-container">
                        <div class="anime-item">
                            <a href="{{ path('voir_anime', { 'mangaId': manga.id, 'saison': 1 }) }}" aria-label="Voir {{ manga.titre }}">
                                <img src="{{ asset('img/anime_pfp/' ~ manga.photo) }}" alt="Couverture de {{ manga.titre }}" loading="lazy" class="clickable-image">
                            </a>
                        </div>
                        <h2>{{ manga.titre }}</h2>
                        <p>
                            {% if mangasWithRoles[manga.titre] is defined %}
                                {% for role in mangasWithRoles[manga.titre] %}
                                    <span style="display: none;">{{ role }}</span>
                                {% endfor %}
                            {% else %}
                            {% endif %}
                        </p>
                    </article>
                {% else %}
                    <p>Aucun manga trouvé.</p>
                {% endfor %}
            </div>
        </div>
    </div>
    </div>
    </div>
    <div class="scan-container-box" style="width: 100%;background: #171717;">
        <h3 style="display: flex; justify-content: center;padding: 20px;margin: 0;">Lire un petit scan pour commencer ?</h3>
        <div class="scan-box">
            <div class="scan-list">
                {% for scan in scans %}
                    {% set parts = scan.lien|split('/') %}
                    {% set nomManga = parts[3] %}
                    <article class="scan-container">
                        <div class="scan-item">
                            <img src="{{ scan.lien }}" alt="Scan de {{ scan.nom }}" loading="lazy" class="clickable-image" data-nom="{{ nomManga }}">
                        </div>
                        <h2>{{ scan.nom }}</h2>
                        <p>
                            {% if scansWithRoles[scan.nom] is defined %}
                                {% for role in scansWithRoles[scan.nom] %}
                                    <span style="display: none;">{{ role }}</span>
                                {% endfor %}
                            {% else %}
                            {% endif %}
                        </p>
                    </article>
                {% else %}
                    <p>Aucun scan trouvé.</p>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
    {{ footer() }}

    
<script>
document.querySelectorAll('.clickable-image').forEach(image => {
    image.addEventListener('click', function() {
        // Récupère le lien de l'image
        const lien = this.src;
        
        // Découpe l'URL pour extraire le nom du manga
        const parts = lien.split('/');
        const nomManga = parts[parts.length - 3]; // Récupère le nom qui se trouve avant le chapitre et la page
        
        const chapter = 1; // Chapitre souhaité
        const page = 1; // Numéro de page souhaité
        window.location.href = `manga/scan/${encodeURIComponent(nomManga)}/${chapter}/${page}`;
    });
});
</script> 

<script>
document.getElementById('searchMangaDownload').addEventListener('input', function() {
    const query = this.value;

    if (query.length < 1) {
        document.getElementById('search-results').innerHTML = '';
        return;
    }

    fetch(`/manga/search/ajax?query=${encodeURIComponent(query)}`)
        .then(response => response.json())
        .then(data => {
            const resultsContainer = document.getElementById('search-results');
            resultsContainer.innerHTML = '';

            data.forEach(manga => {
                const li = document.createElement('li');
                li.textContent = manga.titre; // Affiche le titre du manga
                li.onclick = () => {
                    window.location.href = `manga/${manga.id}`; // Redirige vers la route manga_profile avec l'ID
                };
                resultsContainer.appendChild(li);
            });
        });
});
</script>


{% endblock %}
